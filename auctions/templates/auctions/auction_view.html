{% extends "auctions/layout.html" %}

{% block title %}
{{ auction_item.title }}
{% endblock %}

{% block body %}

{% if error_message %}
<p style="color: red;"><strong>{{ error_message }}</strong></p>
{% endif %}

{% if success_message %}
<p style="color: green;"><strong>{{ success_message }}</strong></p>
{% endif %}

<h2>{{ auction_item.title }}</h2>

{% if user in auction_item.watched_by.all %}
<p style="background-color: lightgreen; width: 87px; padding: 9px; border-radius: 5px;">Watching</p>
<form action="{% url 'update_watchlist' user.id auction_item.id %}" method="post">
    {% csrf_token %}
    <input type="submit" value="Remove From Watchlist">
</form>
{% else %}
<p style="background-color: lightcoral; width: 117px; padding: 9px; border-radius: 5px;">Not Watching</p>
<form action="{% url 'update_watchlist' user.id auction_item.id %}" method="post">
    {% csrf_token %}
    <input type="submit" value="Add To Watchlist">
</form>
{% endif %}



<img src="{{ auction_item.item_image.url }}" alt="Image Not Provided" style="object-fit: contain;" width="400px"
    height="300px">

<p>{{ auction_item.description }}</p>

<p><strong>Current Price: ${{ auction_item.current_price }}</strong></p>

<p>{{ total_bids }} bid{{ total_bids|pluralize }} ha{{ total_bids|pluralize:"s,ve" }} been placed so far</p>
<form action="{% url 'auction_view' auction_item.id %}" method="post">
    {% csrf_token %}
    {{ bid_form.as_p }}

    <!-- {% for error in bid_form.price.errors %}
    <p style="color: red;">{{ error }}</p>
    {% endfor %} -->
    <input type="submit" value="Place Bid">
</form>
&nbsp;
<h3>Details</h3>
<ul>
    <li>Listed by {{ auction_item.creator.username }}</li>
    <li>Posted on {{ auction_item.creation_date|date:"l, F j Y" }} at {{ auction_item.creation_date|time }}</li>
</ul>
<hr>
<h3>Comments</h3>
<ul style="list-style-type: none;">
    {% for comment in auction_item.comments.all %}
    <li>
        <strong>{{ comment.creator.username }}</strong>
        <!-- [{{ comment.creation_date }}] -->
        on {{ comment.creation_date|date:"l, F j Y" }} at {{ comment.creation_date|time }}
        <p>{{ comment.text|linebreaksbr }}</p>
    </li>
    {% endfor %}
</ul>

<form action="{% url 'new_comment' auction_item.id %}" method="post">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <input type="submit" value="Post Comment">
</form>


{% endblock %}